---
title: Farey Linked List
date: '2024-04-11'
slug: farey-linked-list

---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<p>In my <a href="/blog/2024/04/10/farey-numbers-and-linked-lists">last post</a> I talked about using Farey numbers as coordinates for linked list elements. Let’s actually do it.</p>
<!--more-->
<script src=" https://cdn.jsdelivr.net/npm/cytoscape@3.28.1/dist/cytoscape.min.js "></script>
<style type="text/css">
p > code {
    padding: 0 5px;
    margin: 0 2px;
    line-height: 2em;
}

body {
    line-height: 3em !important;
}

.katex {
    font-size: 1.1em !important;
    /*line-height: 1.7em !important;*/
    padding: 0 .15em;
    white-space: nowrap;
}

.cy {
    height: 150px;
    display: block;
}
</style>
<script type="text/javascript">
var cy = null;
let graphit = function(element, destination, label="data(id)") {
    cy = cytoscape({
        container: document.getElementById(destination), // container to render in
        elements: [ ],
        style: [ // the stylesheet for the graph
            {
                selector: 'node',
                style: {
                    'background-color': '#666',
                    'label': label,
                    'text-valign': 'bottom',
                    'text-margin-y': '1em',
                    'font-family': 'Merriweather, serif',
                    'font-size': '1.1em'
                }
            },
            {
                selector: 'edge',
                style: {
                    'width': 7,
                    'line-color': '#ccc',
                    'target-arrow-color': '#ccc',
                    'target-arrow-shape': 'triangle',
                    'curve-style': 'bezier'
                }
            }
        ],
        panningEnabled: false,
        boxSelectionEnabled: false,
        autoungrabify: true,
        autounselectify: true
    });

    let id = (element) => `${element.numerator}/${element.denominator}`;

    let last = undefined;
    let current = element;
    do {
        cy.add({ group: 'nodes', data: { id: id(current) }});

        if (last) {
            cy.add({
                group: 'edges', 
                data: { id: `${id(last)} -> ${id(current)}`, source: id(last), target: id(current) }})
        }
        last = current;
        current = current.next;
    } while(current)
    
    cy.layout({ name: "grid", rows: 1 }).run();
    /*cy.on('tap', 'edge', function(evt) {
        var node = evt.target;
        console.log(node);
        cy.remove(node);
        cy.add({ group: "nodes", data: { id: node.source }})
        //cy.layout({ name: "grid", rows: 1, animate: true });

        //graphit(element, destination, label);
    });*/
}
</script>
<p>In my <a href="/blog/2024/04/10/farey-numbers-and-linked-lists">last post</a> I talked about using Farey numbers as coordinates for linked list elements. Let’s actually do it.</p>
<div id="start-with-a-linked-list" class="section level2">
<h2>Start with a linked list</h2>
<p>A linked list is a sequence of elements, each one linked to the next. In javascript we might set up an empty linked list like this…</p>
<pre class="js"><code>// make one node
let begin = {
    next: undefined
}

// make another node
let end = {
    next: undefined
}

// &quot;link!&quot; – navi
begin.next = end;</code></pre>
<script type="text/javascript">
// make one node
let begin = {
    next: undefined
}

// make another node
let end = {
    next: undefined
}

// "link!" – navi
begin.next = end;
</script>
<p>And visualize it like this…</p>
<div id="begin-end" class="cy">

</div>
<script type="text/javascript">
begin.numerator = 0;
begin.denominator = 1;
begin.next.numerator = 1;
begin.next.denominator = 1;

graphit(begin, "begin-end", "")
</script>
<p>We can terse up the code and give it a name.</p>
<pre class="js"><code>let makeList = () =&gt; ({
    next: {
        next: undefined
    }
});</code></pre>
<script type="text/javascript">
let makeList = () => ({
    next: {
        next: undefined
    }
});
</script>
</div>
<div id="add-a-pinch-of-farey-dust" class="section level2">
<h2>Add a pinch of Farey dust</h2>
<p>Now we’ll add the Farey numbers. <code>begin</code> is always <span class="math inline">\(\displaystyle\frac{0}{1}\)</span>, and <code>end</code> is always <span class="math inline">\(\displaystyle\frac{1}{1}\)</span></p>
<pre class="js"><code>makeList = () =&gt; ({
    numerator: 0,
    denominator: 1,
    next: {
        numerator: 1,
        denominator: 1,
        next: undefined
    }
});

begin = makeList();</code></pre>
<script type="text/javascript">
makeList = () => ({
    numerator: 0,
    denominator: 1,
    next: {
        numerator: 1,
        denominator: 1,
        next: undefined
    }
});

begin = makeList();
</script>
<div id="with-farey-numbers" class="cy">

</div>
<script type="text/javascript">
graphit(begin, "with-farey-numbers", "data(id)");
</script>
<p>We’d like to insert into the list. This function takes an element of the list and inserts a new element after it.</p>
<pre class="js"><code>let insert = function(element) {
    //my kingdom for a type system
    if (!element || !element.next) {
        throw &quot;:(&quot;;
    }

    ///make the new element
    let newEl = {
        // it needs a Farey number
        // to make a new Farey number from two existing Farey numbers, 
        // you sum their numerators and denominators.
        numerator: element.numerator + element.next.numerator,
        denominator: element.denominator + element.next.denominator,

        // it points to what element currently points to.
        next: element.next
    };
    
    //insert the new element into the list by making element point to it.
    element.next = newEl;

    // return the new element
    return newEl;
}</code></pre>
<script type="text/javascript">
let insert = function(element) {
    //my kingdom for a type system
    if (!element || !element.next) {
        throw ":(";
    }

    ///make the new element
    let newEl = {
        // it needs a Farey number
        // to make a new Farey number from two existing Farey numbers, 
        // you sum their numerators and denominators.
        numerator: element.numerator + element.next.numerator,
        denominator: element.denominator + element.next.denominator,

        // it points to what element currently points to.
        next: element.next
    };
    
    //insert the new element into the list by making element point to it.
    element.next = newEl;

    // return the new element
    return newEl;
}
</script>
<p>If we insert an element after begin…</p>
<pre class="js"><code>let half = insert(begin);</code></pre>
<script type="text/javascript">
let half = insert(begin);
</script>
<p>We get</p>
<div id="with-half" class="cy">

</div>
<script type="text/javascript">
graphit(begin, "with-half");
</script>
<p>We can do it again…</p>
<pre class="js"><code>let third = insert(begin);
let twothirds = insert(half);</code></pre>
<script type="text/javascript">
let third = insert(begin);
let twothirds = insert(half);
</script>
<div id="with-third" class="cy">

</div>
<script type="text/javascript">
graphit(begin, "with-third")
</script>
</div>
